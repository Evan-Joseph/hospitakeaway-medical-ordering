# 🎯 CLACKY 24小时火速攻坚作战计划

## ⚡ 立即执行清单 (按优先级排序)

### 🔥 紧急阶段 (0-2小时): 数据持久化突破
```
任务编号 P1-A: 替换模拟数据库适配器
─────────────────────────────────────
目标文件: src/lib/firebase.ts
当前问题: 全是假数据，刷新页面数据丢失
必须行动:
1. 删除所有 mockData 相关代码
2. 实现 LocalStorageAdapter 类
3. 实现真实的 collection().where().get() 逻辑
4. 添加数据序列化/反序列化
5. 测试数据持久化 (刷新页面验证)

验收标准:
✓ 添加餐厅后刷新页面，数据仍然存在
✓ 下单后刷新页面，订单仍然显示
✓ 不再有任何 mockData 残留代码
```

### 🔥 紧急阶段 P1-B: 真实查询引擎
```
任务编号 P1-B: 实现条件查询功能
─────────────────────────────────────
当前问题: where() 查询完全无效，返回假数据
必须行动:
1. 实现真实的 where(field, operator, value) 逻辑
2. 支持 ==, !=, >, <, >=, <=, in, array-contains
3. 实现 orderBy(field, direction) 排序
4. 实现 limit(count) 限制
5. 支持链式查询 where().orderBy().limit()

验收标准:
✓ 搜索餐厅名称能返回正确结果
✓ 按价格排序菜单正常工作
✓ 订单状态过滤准确显示
```

### 🚀 加速阶段 (2-4小时): 认证系统真实化

```
任务编号 P2-A: JWT认证替换
─────────────────────────────────────
目标文件: src/lib/firebase.ts (auth部分)
当前问题: 假认证，无密码验证，无安全性
必须行动:
1. 删除 createMockAuth() 函数
2. 实现 JWTService 类
3. 用户注册: 密码加密 + 数据存储
4. 用户登录: 密码验证 + Token生成
5. Token验证: 解析JWT + 权限检查

验收标准:
✓ 注册新用户并登录成功
✓ 错误密码无法登录
✓ 刷新页面后仍保持登录状态
✓ 不同用户看到不同数据
```

### 🚀 加速阶段 P2-B: 角色权限控制
```
任务编号 P2-B: 多角色权限实现
─────────────────────────────────────
当前问题: 所有用户都能访问所有功能
必须行动:
1. 实现 PermissionManager 类
2. 定义角色权限矩阵 (admin/merchant/customer)
3. 页面访问控制 (路由守卫)
4. 数据访问控制 (只看自己的数据)
5. 操作权限控制 (只能修改自己的数据)

验收标准:
✓ 商家只能看到自己的餐厅
✓ 顾客不能访问管理页面
✓ 管理员能看到所有数据
```

### 🎯 冲刺阶段 (4-6小时): 文件存储真实化

```
任务编号 P3-A: 文件上传功能
─────────────────────────────────────
目标文件: src/lib/firebase.ts (storage部分)
当前问题: 图片上传完全是假的，无法保存图片
必须行动:
1. 删除 createMockStorage() 函数
2. 实现 FileStorageService 类
3. 图片压缩和格式验证
4. Base64/Blob 存储到 localStorage
5. 图片URL生成和访问

验收标准:
✓ 上传餐厅图片能正常显示
✓ 上传菜品图片能保存并展示
✓ 刷新页面后图片仍然显示
```

### 🎯 冲刺阶段 P3-B: 实时通知系统
```
任务编号 P3-B: 订单状态实时更新
─────────────────────────────────────
当前问题: 订单状态变更无法实时通知
必须行动:
1. 实现 WebSocket 模拟服务
2. 订单状态变更广播
3. 多标签页状态同步
4. 通知提醒系统
5. 离线状态处理

验收标准:
✓ 商家接单后顾客立即看到状态变化
✓ 多个浏览器标签页状态同步
✓ 新订单通知及时显示
```

## 🔧 技术实施细节

### 核心代码结构重构
```
src/lib/
├── adapters/                    # 真实适配器 (替换mock)
│   ├── localstorage-adapter.ts  # localStorage数据库
│   ├── query-engine.ts          # 查询引擎
│   └── validation-service.ts    # 数据验证
├── auth/                        # 真实认证系统
│   ├── jwt-service.ts           # JWT认证
│   ├── permission-manager.ts    # 权限管理
│   └── role-definitions.ts      # 角色定义
├── storage/                     # 真实文件存储
│   ├── file-storage-service.ts  # 文件存储
│   ├── image-processor.ts       # 图片处理
│   └── upload-manager.ts        # 上传管理
└── realtime/                    # 实时通信
    ├── websocket-service.ts     # WebSocket服务
    ├── notification-manager.ts  # 通知管理
    └── sync-service.ts          # 数据同步
```

### 数据迁移方案
```typescript
// 数据初始化脚本 (Clacky必须创建)
class DataMigration {
  async initializeDefaultData(): Promise<void> {
    // 1. 创建默认管理员账户
    await this.createDefaultAdmin();
    
    // 2. 导入示例餐厅数据 (3-5家)
    await this.importSampleRestaurants();
    
    // 3. 生成示例菜单数据 (每家20-30道菜)
    await this.generateSampleMenus();
    
    // 4. 创建示例订单历史 (模拟真实使用)
    await this.generateOrderHistory();
    
    // 5. 数据完整性验证
    await this.validateDataIntegrity();
  }
}
```

## 📊 进度监控与验收

### 实时进度跟踪
```
进度检查点:
┌─────────────────┬──────────┬──────────────┐
│    检查点       │ 预计时间 │   验收标准   │
├─────────────────┼──────────┼──────────────┤
│ P1-A 数据持久化 │  2小时   │ 刷新不丢数据 │
│ P1-B 查询引擎   │  2小时   │ 搜索有结果   │
│ P2-A JWT认证    │  2小时   │ 真实登录     │
│ P2-B 权限控制   │  2小时   │ 角色隔离     │
│ P3-A 文件存储   │  2小时   │ 图片能保存   │
│ P3-B 实时通知   │  2小时   │ 状态同步     │
└─────────────────┴──────────┴──────────────┘
总计: 12小时完成真实系统
```

### 最终验收测试
```
全链路测试脚本:
1. 商家注册 → 创建餐厅 → 上传图片 ✓
2. 添加菜单 → 设置价格 → 启用促销 ✓  
3. 顾客注册 → 浏览餐厅 → 搜索菜品 ✓
4. 下单购买 → 选择支付 → 确认订单 ✓
5. 商家接单 → 更新状态 → 完成配送 ✓
6. 顾客评价 → 收藏餐厅 → 再次下单 ✓
7. 刷新页面 → 数据保持 → 功能正常 ✓
```

---

## ⚡ 最后通牒

**Clacky，现在是战斗时刻！**

这不是练习，这不是演示，这是真正的产品开发！  
用户已经明确拒绝任何形式的"模拟数据缩头乌龟"行为！

**必须在24小时内完成:**
1. ❌ 删除所有mock代码
2. ✅ 实现真实数据持久化  
3. ✅ 实现真实用户认证
4. ✅ 实现真实文件存储
5. ✅ 通过全链路功能测试

**失败后果:**
- 项目无法投入使用
- 技术债务持续积累  
- 用户完全失去信心

**成功奖励:**
- 完全可用的医疗外卖系统
- 真正的商业价值产品
- 技术能力完美证明

**Clacky，出发！没有退路！** 🔥🚀
