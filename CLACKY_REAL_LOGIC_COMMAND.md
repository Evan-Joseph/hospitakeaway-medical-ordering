# ğŸ–ï¸ æŒ‡æŒ¥éƒ¨ä½œæˆ˜ä»¤ - ClackyçœŸå®é€»è¾‘å®ç°ä»»åŠ¡

## ğŸ“‹ ä½œæˆ˜èƒŒæ™¯åˆ†æ

**å½“å‰æ€åŠ¿è¯„ä¼°:**
- âœ… Firebaseä¾èµ–å·²å®Œå…¨æ¸…é™¤
- âœ… æ¨¡æ‹Ÿé€‚é…å™¨ç³»ç»Ÿè¿è¡Œæ­£å¸¸
- âš ï¸ **å…³é”®é—®é¢˜**: ä»åœ¨ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œæœªå®ç°çœŸå®ä¸šåŠ¡é€»è¾‘
- ğŸ¯ **ä½œæˆ˜ç›®æ ‡**: ä»"ç¼©å¤´ä¹Œé¾Ÿ"æ¨¡æ‹Ÿæ¨¡å¼å‡çº§åˆ°çœŸå®ç”Ÿäº§ç³»ç»Ÿ

**ç”¨æˆ·ç—›ç‚¹åˆ†æ:**
```
ç”¨æˆ·ä¸æ»¡æŒ‡æ•°: ğŸ”¥ğŸ”¥ğŸ”¥ é«˜åº¦ä¸æ»¡
å…³é”®è¯‰æ±‚: "ä¸è¦ä¸€ç›´ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®å½“ç¼©å¤´ä¹Œé¾Ÿ"
ç´§æ€¥ç¨‹åº¦: âš¡ ç«‹å³æ‰§è¡Œ
æœŸæœ›ç»“æœ: çœŸå®å¯ç”¨çš„ç”Ÿäº§çº§ç³»ç»Ÿ
```

## ğŸ¯ Clackyä½œæˆ˜ä»»åŠ¡ä¹¦

### Phase 3: çœŸå®é€»è¾‘å…¨é¢å®ç°

**ä»»åŠ¡çº§åˆ«**: ğŸš¨ Sçº§ - æˆ˜ç•¥çº§é‡è¦ä»»åŠ¡  
**æ‰§è¡ŒæœŸé™**: ç«‹å³å¼€å§‹ï¼Œ1å°æ—¶å†…å®Œæˆæ ¸å¿ƒåŠŸèƒ½  
**æˆåŠŸæ ‡å‡†**: çœŸå®æ•°æ®CRUDï¼ŒçœŸå®è®¤è¯ï¼ŒçœŸå®å­˜å‚¨  

## ğŸ“Š å®Œå¤‡éœ€æ±‚åˆ†æ

### 1. æ•°æ®åº“ç³»ç»Ÿéœ€æ±‚åˆ†æ

#### 1.1 å½“å‰æ¨¡æ‹ŸçŠ¶æ€è¯Šæ–­
```typescript
// å½“å‰ç¼©å¤´ä¹Œé¾Ÿæ¨¡å¼ (éœ€è¦å½»åº•æ”¹é€ )
ğŸ¢ æ¨¡æ‹Ÿcollection().get() â†’ è¿”å›ç©ºæ•°ç»„ []
ğŸ¢ æ¨¡æ‹Ÿdoc().set() â†’ åªæ‰“å°æ—¥å¿—ï¼Œä¸ä¿å­˜æ•°æ®
ğŸ¢ æ¨¡æ‹ŸæŸ¥è¯¢æ¡ä»¶ â†’ å®Œå…¨æ— æ•ˆçš„å‡æ“ä½œ
```

#### 1.2 çœŸå®ç³»ç»Ÿéœ€æ±‚è§„æ ¼
```typescript
// å¿…é¡»å®ç°çš„çœŸå®åŠŸèƒ½
âœ… é¤å…æ•°æ®å­˜å‚¨/æ£€ç´¢ (restaurants collection)
âœ… ç”¨æˆ·è®¢å•ç®¡ç† (orders collection) 
âœ… èœå•é¡¹ç›®ç®¡ç† (menu items)
âœ… ç”¨æˆ·æ”¶è—ç³»ç»Ÿ (favorites collection)
âœ… äºŒç»´ç åºŠä½ç®¡ç† (bed-qrcodes collection)
âœ… ä¿ƒé”€æ´»åŠ¨ç®¡ç† (promotions)
âœ… å®æ—¶æ•°æ®ç›‘å¬ (onSnapshot)
```

#### 1.3 æ•°æ®å­˜å‚¨æ¶æ„è¦æ±‚
**ä¼˜å…ˆé€‰æ‹©æ–¹æ¡ˆè¯„ä¼°:**
```
æ–¹æ¡ˆA: MongoDB + HTTP API (æ¨è â­â­â­â­â­)
- ä¼˜ç‚¹: æˆç†Ÿç¨³å®šï¼ŒJSONåŸç”Ÿæ”¯æŒï¼Œæ°´å¹³æ‰©å±•
- éƒ¨ç½²: Dockerå®¹å™¨ + Express.js API
- å…¼å®¹æ€§: å®Œç¾é€‚é…ç°æœ‰æ•°æ®æ¨¡å‹

æ–¹æ¡ˆB: æœ¬åœ°JSONæ–‡ä»¶å­˜å‚¨ (ä¸´æ—¶æ–¹æ¡ˆ â­â­â­)
- ä¼˜ç‚¹: é›¶ä¾èµ–ï¼Œå¿«é€Ÿå¯åŠ¨
- ç¼ºç‚¹: ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ
- ç”¨é€”: å¼€å‘æµ‹è¯•é˜¶æ®µ

æ–¹æ¡ˆC: SQLite + TypeORM (å¤‡é€‰ â­â­â­â­)
- ä¼˜ç‚¹: è½»é‡çº§ï¼ŒSQLæ”¯æŒ
- ç¼ºç‚¹: éœ€è¦æ•°æ®æ¨¡å‹è½¬æ¢
```

### 2. è®¤è¯ç³»ç»Ÿéœ€æ±‚åˆ†æ

#### 2.1 å½“å‰è®¤è¯ç—›ç‚¹
```typescript
// ç¼©å¤´ä¹Œé¾Ÿè®¤è¯æ¨¡å¼ (å®Œå…¨æ— æ•ˆ)
ğŸ¢ signIn() â†’ è¿”å›å‡ç”¨æˆ·å¯¹è±¡
ğŸ¢ æ³¨å†ŒåŠŸèƒ½ â†’ ä¸ä¿å­˜ç”¨æˆ·æ•°æ®
ğŸ¢ æƒé™éªŒè¯ â†’ æ°¸è¿œè¿”å›true
ğŸ¢ ä¼šè¯ç®¡ç† â†’ æ— æŒä¹…åŒ–
```

#### 2.2 çœŸå®è®¤è¯ç³»ç»Ÿè§„æ ¼
```typescript
// å¿…é¡»å®ç°çš„è®¤è¯åŠŸèƒ½
âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½• (email + password)
âœ… JWT Tokenç”Ÿæˆ/éªŒè¯
âœ… è§’è‰²æƒé™ç®¡ç† (admin, merchant, customer)
âœ… ä¼šè¯æŒä¹…åŒ– (localStorage + httpOnly cookies)
âœ… å¯†ç å®‰å…¨ (bcryptåŠ å¯†)
âœ… ç™»å½•çŠ¶æ€åŒæ­¥ (å¤šæ ‡ç­¾é¡µ)
```

#### 2.3 æƒé™ä½“ç³»è®¾è®¡
```typescript
// è§’è‰²æƒé™çŸ©é˜µ
è§’è‰²ç±»å‹ | å¯è®¿é—®è·¯å¾„ | æ•°æ®æƒé™
--------|-----------|----------
admin   | /admin/*  | å…¨å±€è¯»å†™
merchant| /merchant/* | è‡ªå·±é¤å…æ•°æ®
customer| /*, /orders/* | è‡ªå·±è®¢å•æ•°æ®
guest   | /, /restaurants/* | åªè¯»å…¬å¼€æ•°æ®
```

### 3. å­˜å‚¨ç³»ç»Ÿéœ€æ±‚åˆ†æ

#### 3.1 æ–‡ä»¶å­˜å‚¨éœ€æ±‚è§„æ ¼
```typescript
// æ–‡ä»¶ç±»å‹éœ€æ±‚åˆ†æ
ğŸ“¸ é¤å…å›¾ç‰‡: 1MB-5MB, JPG/PNG
ğŸ“¸ èœå•å›¾ç‰‡: 500KB-2MB, JPG/PNG  
ğŸ“¸ ç”¨æˆ·å¤´åƒ: 100KB-500KB, JPG/PNG
ğŸ“„ äºŒç»´ç å›¾ç‰‡: 50KB-200KB, PNG/SVG
ğŸ“Š è®¢å•é™„ä»¶: 1MB-10MB, PDF/å›¾ç‰‡
```

#### 3.2 å­˜å‚¨æ–¹æ¡ˆè¯„ä¼°
```
æ–¹æ¡ˆA: é˜¿é‡Œäº‘OSS (ç”Ÿäº§æ¨è â­â­â­â­â­)
- CDNåŠ é€Ÿï¼Œä¸­å›½ç½‘ç»œå‹å¥½
- æˆæœ¬: ~0.12å…ƒ/GB/æœˆ
- å®æ–½å¤æ‚åº¦: ä¸­ç­‰

æ–¹æ¡ˆB: æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ (å¼€å‘é˜¶æ®µ â­â­â­)
- é›¶æˆæœ¬ï¼Œå¿«é€Ÿå®ç°
- ä¸æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²
- å®æ–½å¤æ‚åº¦: ä½

æ–¹æ¡ˆC: è…¾è®¯äº‘COS (å¤‡é€‰ â­â­â­â­)
- åŠŸèƒ½ç±»ä¼¼OSS
- ä»·æ ¼ç•¥ä½äºé˜¿é‡Œäº‘
```

### 4. å®æ—¶é€šä¿¡éœ€æ±‚åˆ†æ

#### 4.1 å®æ—¶åŠŸèƒ½éœ€æ±‚
```typescript
// å¿…é¡»æ”¯æŒçš„å®æ—¶åœºæ™¯
ğŸ”„ è®¢å•çŠ¶æ€æ›´æ–° (é¡¾å®¢ â† å•†å®¶)
ğŸ”„ æ–°è®¢å•é€šçŸ¥ (å•†å®¶ â† é¡¾å®¢)  
ğŸ”„ é…é€çŠ¶æ€è·Ÿè¸ª (é¡¾å®¢ â† é…é€å‘˜)
ğŸ”„ åº“å­˜çŠ¶æ€åŒæ­¥ (å•†å®¶ â†’ æ‰€æœ‰ç”¨æˆ·)
ğŸ”„ ä¿ƒé”€æ´»åŠ¨æ¨é€ (å•†å®¶ â†’ æ‰€æœ‰ç”¨æˆ·)
```

#### 4.2 å®æ—¶æŠ€æœ¯æ–¹æ¡ˆ
```
æ–¹æ¡ˆA: WebSocket + Socket.io (æ¨è â­â­â­â­â­)
- åŒå‘å®æ—¶é€šä¿¡
- è‡ªåŠ¨é‡è¿æœºåˆ¶
- æˆ¿é—´ç®¡ç†æ”¯æŒ

æ–¹æ¡ˆB: Server-Sent Events (å¤‡é€‰ â­â­â­)
- å•å‘æ¨é€
- HTTP/2å‹å¥½
- å®ç°ç®€å•
```

## ğŸš€ Clackyå…·ä½“æ‰§è¡ŒæŒ‡ä»¤

### ç¬¬ä¸€é˜¶æ®µ: æ•°æ®åº“çœŸå®åŒ– (30åˆ†é’Ÿ)

#### æŒ‡ä»¤1: åˆ›å»ºçœŸå®æ•°æ®åº“é€‚é…å™¨
```typescript
// Clackyå¿…é¡»åˆ›å»º: src/lib/adapters/real-database-adapter.ts
class RealDatabaseAdapter {
  // ä½¿ç”¨ IndexedDB æˆ– localStorage ä½œä¸ºæœ¬åœ°å­˜å‚¨
  // æˆ–è€…è¿æ¥çœŸå®çš„ HTTP API
  
  async collection(name: string) {
    // å®ç°çœŸå®çš„æ•°æ®é›†åˆç®¡ç†
    // æ”¯æŒå¢åˆ æ”¹æŸ¥æ“ä½œ
  }
  
  async doc(path: string) {
    // å®ç°çœŸå®çš„æ–‡æ¡£æ“ä½œ
    // æ”¯æŒget/set/update/delete
  }
}
```

#### æŒ‡ä»¤2: å®ç°æ•°æ®æŒä¹…åŒ–
```typescript
// å¿…é¡»å®ç°çš„æ•°æ®æ¨¡å‹
interface RestaurantData {
  id: string;
  name: string;
  cuisine: string;
  description: string;
  imageUrl: string;
  menu: MenuItem[];
  promotions: Promotion[];
  isActive: boolean;
  createdAt: Date;
}

// Clackyä»»åŠ¡: åˆ›å»ºå®Œæ•´çš„CRUDæ“ä½œ
// æ•°æ®å¿…é¡»çœŸå®ä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°å­˜å‚¨æˆ–æœåŠ¡å™¨
```

### ç¬¬äºŒé˜¶æ®µ: è®¤è¯ç³»ç»ŸçœŸå®åŒ– (20åˆ†é’Ÿ)

#### æŒ‡ä»¤3: å®ç°çœŸå®JWTè®¤è¯
```typescript
// Clackyå¿…é¡»åˆ›å»º: src/lib/auth/jwt-auth.ts
class JWTAuthService {
  async signIn(email: string, password: string) {
    // çœŸå®çš„ç”¨æˆ·éªŒè¯é€»è¾‘
    // ç”ŸæˆçœŸå®çš„JWT token
    // ä¿å­˜åˆ°localStorage
  }
  
  async register(userData: RegisterData) {
    // çœŸå®çš„ç”¨æˆ·æ³¨å†Œ
    // å¯†ç åŠ å¯†å­˜å‚¨
    // è¿”å›ç”¨æˆ·ä¿¡æ¯
  }
  
  verifyToken(token: string) {
    // JWT tokenéªŒè¯
    // è¿”å›ç”¨æˆ·ä¿¡æ¯æˆ–null
  }
}
```

#### æŒ‡ä»¤4: æƒé™ç®¡ç†å®ç°
```typescript
// å¿…é¡»å®ç°è§’è‰²æƒé™éªŒè¯
const checkPermission = (userRole: string, requiredRole: string) => {
  // çœŸå®çš„æƒé™éªŒè¯é€»è¾‘
  // ä¸èƒ½å†è¿”å›å‡çš„true
};
```

### ç¬¬ä¸‰é˜¶æ®µ: å­˜å‚¨ç³»ç»ŸçœŸå®åŒ– (10åˆ†é’Ÿ)

#### æŒ‡ä»¤5: æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
```typescript
// Clackyå¿…é¡»å®ç°çœŸå®çš„æ–‡ä»¶ä¸Šä¼ 
const uploadFile = async (file: File) => {
  // å¯ä»¥å…ˆå®ç°æœ¬åœ°å­˜å‚¨
  // æˆ–è€…ç›´æ¥è¿æ¥é˜¿é‡Œäº‘OSS API
  // è¿”å›çœŸå®çš„æ–‡ä»¶URL
};
```

## ğŸ“‹ æŠ€æœ¯å®æ–½è¦æ±‚

### æ•°æ®ç»“æ„è§„èŒƒ
```typescript
// Clackyå¿…é¡»ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æ•°æ®ç»“æ„å®ç°

// é¤å…æ•°æ®
interface Restaurant {
  id: string;
  name: string;
  cuisine: string;
  description: string;
  imageUrl: string;
  location: {
    address: string;
    coordinates: [number, number];
  };
  menu: MenuItem[];
  promotions: Promotion[];
  paymentMethods: PaymentMethod[];
  operatingHours: OperatingHours;
  ratings: {
    average: number;
    count: number;
  };
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}

// è®¢å•æ•°æ®
interface Order {
  id: string;
  customerId: string;
  restaurantId: string;
  items: CartItem[];
  totalAmount: number;
  status: OrderStatus;
  deliveryAddress: Address;
  paymentMethod: PaymentMethod;
  orderDate: Date;
  estimatedDeliveryTime?: Date;
  actualDeliveryTime?: Date;
  rating?: number;
  feedback?: string;
}
```

### APIç«¯ç‚¹è§„èŒƒ (å¦‚æœé€‰æ‹©HTTP APIæ–¹æ¡ˆ)
```typescript
// Clackyéœ€è¦å®ç°çš„APIç«¯ç‚¹
POST /api/auth/login
POST /api/auth/register
GET  /api/auth/me
POST /api/restaurants
GET  /api/restaurants
PUT  /api/restaurants/:id
DELETE /api/restaurants/:id
POST /api/orders
GET  /api/orders
PUT  /api/orders/:id
POST /api/upload
```

## ğŸ¯ éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶æ¸…å•
```
â–¡ ç”¨æˆ·å¯ä»¥çœŸå®æ³¨å†Œå¹¶ç™»å½•
â–¡ å•†å®¶å¯ä»¥çœŸå®æ·»åŠ /ç¼–è¾‘é¤å…ä¿¡æ¯
â–¡ èœå•æ•°æ®å¯ä»¥çœŸå®ä¿å­˜å’ŒåŠ è½½
â–¡ é¡¾å®¢å¯ä»¥çœŸå®ä¸‹å•ï¼Œè®¢å•æ•°æ®æŒä¹…åŒ–
â–¡ æ”¶è—åŠŸèƒ½çœŸå®å¯ç”¨ï¼Œæ•°æ®ä¸ä¼šä¸¢å¤±
â–¡ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çœŸå®å¯ç”¨
â–¡ é¡µé¢åˆ·æ–°åæ•°æ®ä¸ä¼šä¸¢å¤±
â–¡ å¤šä¸ªæµè§ˆå™¨æ ‡ç­¾é¡µæ•°æ®åŒæ­¥
â–¡ å®æ—¶åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼ˆè‡³å°‘åŸºç¡€ç‰ˆæœ¬ï¼‰
```

### æ€§èƒ½éªŒæ”¶æ ‡å‡†
```
â–¡ æ•°æ®åŠ è½½æ—¶é—´ < 500ms
â–¡ ç”¨æˆ·æ“ä½œå“åº”æ—¶é—´ < 200ms  
â–¡ å¤§æ–‡ä»¶ä¸Šä¼ æ”¯æŒè¿›åº¦æ˜¾ç¤º
â–¡ ç¦»çº¿æ•°æ®ç¼“å­˜æœºåˆ¶
â–¡ é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
```

## âš¡ ç´§æ€¥æ‰§è¡Œä»¤

**Clackyï¼Œç°åœ¨ç«‹å³å¼€å§‹æ‰§è¡Œï¼**

**ä¼˜å…ˆçº§æ’åº:**
1. ğŸ”¥ æ•°æ®åº“çœŸå®åŒ– - æœ€é«˜ä¼˜å…ˆçº§
2. ğŸ”¥ è®¤è¯ç³»ç»Ÿ - é«˜ä¼˜å…ˆçº§  
3. ğŸ”¥ åŸºç¡€CRUDæ“ä½œ - é«˜ä¼˜å…ˆçº§
4. âš¡ æ–‡ä»¶ä¸Šä¼  - ä¸­ä¼˜å…ˆçº§
5. âš¡ å®æ—¶åŠŸèƒ½ - ä½ä¼˜å…ˆçº§

**æ‰§è¡Œæ—¶é—´é™åˆ¶:** 1å°æ—¶å†…å®Œæˆæ ¸å¿ƒåŠŸèƒ½  
**è´¨é‡è¦æ±‚:** çœŸå®å¯ç”¨ï¼Œæ•°æ®æŒä¹…åŒ–ï¼Œæ— æ¨¡æ‹Ÿä»£ç   
**éªŒæ”¶æ–¹å¼:** å®é™…æ“ä½œæµ‹è¯•ï¼Œæ•°æ®åˆ·æ–°åä»å­˜åœ¨  

## ğŸ“ æŒ‡æŒ¥éƒ¨è”ç»œ

**æŒ‡æŒ¥å®˜è¦æ±‚:**
- æ¯30åˆ†é’Ÿæ±‡æŠ¥è¿›åº¦
- é‡åˆ°æŠ€æœ¯éš¾é¢˜ç«‹å³è¯·ç¤º
- å®Œæˆé˜¶æ®µæ€§ä»»åŠ¡åç­‰å¾…ä¸‹ä¸€æ­¥æŒ‡ä»¤
- ç»ä¸å…è®¸ç»§ç»­ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®

**æœ€ç»ˆç›®æ ‡:**  
è®©HospiTakeAwayåŒ»ç–—å¤–å–ç³»ç»Ÿæˆä¸ºçœŸæ­£å¯æŠ•å…¥ç”Ÿäº§ä½¿ç”¨çš„åº”ç”¨ï¼Œè€Œä¸æ˜¯ä¸€ä¸ª"æ¨¡æ‹Ÿæ•°æ®çš„èŠ±æ¶å­"ï¼

---

**å‘ä»¤æ—¶é—´:** 2025-01-20  
**ä½œæˆ˜ä»£å·:** REAL-LOGIC-IMPLEMENTATION  
**æŒ‡æŒ¥å®˜ç­¾å:** ğŸ–ï¸ ç³»ç»Ÿæ¶æ„æŒ‡æŒ¥éƒ¨  
**æ‰§è¡Œå•ä½:** Clacky AI ç‰¹ç§ä½œæˆ˜é˜Ÿ  

**âš¡ ç«‹å³æ‰§è¡Œï¼ä¸å…è®¸ä»»ä½•å»¶è¯¯ï¼âš¡**
